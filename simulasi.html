<!DOCTYPE html>
<html lang="en">
<head>
  <title>Simulasi | TRY OUT</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body style="background: linear-gradient(135deg, #326698 0%, #4a7fb8 100%, #667eea 100%); font-family: 'Poppins', sans-serif;">

<div class="container-fluid text-white" 
	style="background: linear-gradient(135deg, #326698 0%, #4a7fb8 100%); box-shadow: 0 4px 20px rgba(0,0,0,0.1); height:120px; position:fixed; top:0px; left:0px; right:0px; z-index:1000;"
	>
	  <div class="row h-100 align-items-center">
		<div class="col-12">
			<div class="d-flex align-items-center justify-content-center">
				<div class="header-text">
					<h3 class="mb-1" style="font-weight: 700; font-size: 20px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">SMPN 10 BANAWA SELATAN</h3>
					<p class="mb-0" style="font-size: 14px; opacity: 0.9; text-shadow: 0 1px 2px rgba(0,0,0,0.3);" id="mapel-header">TRY OUT</p>
				</div>
			</div>
		</div>
	  </div>
</div>

<div class="wrapper " style="margin: 0 auto; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding-top: 140px;">
  <div id="formContent" style="max-width: 800px;">
    
	<div class="d-flex justify-content-between mb-3">
		<span id="user-info" style="font-weight: 600; color: #333;"></span>
		<span id="question-counter" style="font-weight: 600; color: #333;"></span>
	</div>
	
	<div id="quiz-container">
		<div id="question-text" style="font-size: 1.1rem; font-weight: 500; color: #000; text-align: left; margin-bottom: 20px;">
			</div>
		
		<div id="options-container" style="text-align: left;">
			</div>
	</div>
	
	<div class="d-flex justify-content-between mt-4">
		<button id="prev-btn" class="btn btn-secondary" style="border-radius: 12px; padding: 12px 25px;"><i class="fas fa-arrow-left mr-2"></i>Sebelumnya</button>
		<button id="next-btn" class="btn btn-primary custom-btn" style="padding: 12px 25px;">Berikutnya<i class="fas fa-arrow-right ml-2"></i></button>
		<button id="submit-btn" class="btn btn-success" style="border-radius: 12px; padding: 12px 25px; display: none;"><i class="fas fa-check-circle mr-2"></i>Selesai</button>
	</div>

  </div> 
</div>

<div  style="position:absolute;top:0px;left:0px;right:0px;bottom:0px;background:#fff;opacity:0.5;z-index:99999;display:none" id="loader">
<img class="loader" src="https://pusmendik.kemdikbud.go.id/tka/_assets/images/loader2.gif">
</div>

<style>
/* ... (Salin semua CSS dari index.html) ... */
	.bg-pattern {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-image: 
			radial-gradient(circle at 20% 20%, rgba(255,255,255,0.1) 2px, transparent 2px),
			radial-gradient(circle at 80% 80%, rgba(255,255,255,0.08) 2px, transparent 2px),
			radial-gradient(circle at 40% 40%, rgba(255,255,255,0.05) 1px, transparent 1px);
		background-size: 50px 50px, 80px 80px, 30px 30px;
		z-index: -1;
	}
	.loader {
	  margin: 0;
	  position: absolute;
	  top: 50%;
	  left: 50%;
	  -ms-transform: translate(-50%, -50%);
	  transform: translate(-50%, -50%);
	}
	.wrapper {
	  display: flex;
	  align-items: center;
	  flex-direction: column; 
	  justify-content: center;
	  width: 100%;
	  min-height: 100vh;
	  padding: 20px;
	  margin: 0 auto;
	  text-align: center;
	}
	.logo-container {
		display: flex;
		align-items: center;
	}
	.header-text h3 {
		margin: 0;
		letter-spacing: 1px;
	}
	.header-text p {
		margin: 0;
		font-weight: 400;
	}
	#formContent {
	  -webkit-border-radius: 20px;
	  border-radius: 20px;
	  background: #ffffff;
	  padding: 45px;
	  width: 90%;
	  max-width: 480px;
	  position: relative;
	  -webkit-box-shadow: 0 15px 35px 0 rgba(50, 102, 152, 0.1);
	  box-shadow: 0 15px 35px 0 rgba(50, 102, 152, 0.1);
	  text-align: center;
	  border: 1px solid rgba(255,255,255,0.8);
	}
	.header-icon .icon-circle {
		width: 80px;
		height: 80px;
		border-radius: 50%;
		background: linear-gradient(135deg, #326698 0%, #4a7fb8 100%);
		display: flex;
		align-items: center;
		justify-content: center;
		margin: 0 auto;
		box-shadow: 0 10px 30px rgba(50, 102, 152, 0.2);
		border: 2px solid rgba(50, 102, 152, 0.1);
	}
	.header-icon .icon-circle i {
		font-size: 35px;
		color: white;
	}
	.form-label {
		color: #333;
		font-weight: 600;
		margin-bottom: 10px;
		font-size: 14px;
		display: flex;
		align-items: center;
	}
	.form-label i {
		color: #326698;
		margin-right: 8px;
		font-size: 16px;
	}
	.custom-select {
		border: 2px solid #e8ecf1;
		border-radius: 12px;
		padding: 14px 18px;
		font-size: 15px;
		font-weight: 500;
		transition: all 0.3s ease;
		background-color: #fff;
		background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23326698" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>');
		background-repeat: no-repeat;
		background-position: right 15px center;
		background-size: 12px;
		appearance: none;
		-webkit-appearance: none;
		-moz-appearance: none;
		cursor: pointer;
		box-shadow: 0 2px 8px rgba(50, 102, 152, 0.08);
		height:auto;
	}
	.custom-select:focus {
		border-color: #326698;
		box-shadow: 0 0 0 3px rgba(50, 102, 152, 0.1), 0 4px 16px rgba(50, 102, 152, 0.15);
		outline: none;
		transform: translateY(-1px);
	}
	.custom-select:hover {
		border-color: #4a7fb8;
		box-shadow: 0 4px 12px rgba(50, 102, 152, 0.12);
	}
	.custom-select option {
		padding: 12px;
		font-weight: 500;
		color: #333;
		background-color: #fff;
	}
	.custom-select option:hover {
		background-color: #f8f9fa;
	}
	.custom-btn {
		background: linear-gradient(135deg, #326698 0%, #4a7fb8 100%);
		border: none;
		border-radius: 12px;
		padding: 16px 30px;
		font-weight: 600;
		font-size: 16px;
		transition: all 0.3s ease;
		box-shadow: 0 6px 20px rgba(50, 102, 152, 0.25);
		position: relative;
		overflow: hidden;
	}
	.custom-btn::before {
		content: '';
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 100%;
		background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
		transition: left 0.5s;
	}
	.custom-btn:hover::before {
		left: 100%;
	}
	.custom-btn:hover {
		transform: translateY(-2px);
		box-shadow: 0 8px 25px rgba(50, 102, 152, 0.35);
		background: linear-gradient(135deg, #4a7fb8 0%, #326698 100%);
	}
	.custom-btn:active {
		transform: translateY(0);
	}
	.form-group {
		margin-bottom: 30px;
		position: relative;
	}
	.form-group:last-of-type {
		margin-bottom: 20px;
	}
	.footer-info {
		position: fixed;
		bottom: 15px;
		left: 0;
		right: 0;
		z-index: 10;
	}
	.copyright-card {
		background: rgba(255, 255, 255, 0.95);
		padding: 10px 20px;
		border-radius: 25px;
		font-size: 12px;
		color: #333;
		box-shadow: 0 4px 15px rgba(0,0,0,0.08);
		border: 1px solid rgba(255,255,255,0.5);
		display: inline-flex;
		align-items: center;
		margin: 0 auto;
	}
	.copyright-card i {
		color: #326698;
	}
	@media (max-width: 768px) {
		#formContent {
			margin: 20px;
			padding: 35px 25px;
		}
		
		.header-icon .icon-circle {
			width: 60px;
			height: 60px;
		}
		
		.header-icon .icon-circle i {
			font-size: 25px;
		}
		
		.footer-info {
			bottom: 10px;
		}
		
		.copyright-card {
			font-size: 10px;
			padding: 8px 15px;
		}
		.container-fluid {
			height: 100px !important;
		}
		.header-text h3 {
			font-size: 20px !important;
		}
		.header-text p {
			font-size: 12px !important;
		}
		.logo-container img {
			height: 45px !important;
		}
		.custom-select {
			padding: 12px 16px;
			font-size: 14px;
		}
		.form-label {
			font-size: 13px;
		}
		.custom-btn {
			padding: 14px 25px;
			font-size: 15px;
		}
	}
	#loader {
		background: rgba(50, 102, 152, 0.1);
	}
	h2.inactive {
	  color: #cccccc;
	}
	h2.active {
	  color: #0d0d0d;
	  border-bottom: 2px solid #5fbae9;
	}
	input[type=text] {
	  border: none;
	  color: #0d0d0d;
	  text-decoration: none;
	  display: inline-block;
	  font-size: 16px;
	  border-radius:0px;
	  border-bottom:2px solid #eee;
	}
	input[type=password] {
	  border: none;
	  color: #0d0d0d;
	  text-decoration: none;
	  display: inline-block;
	  font-size: 16px;
	  border-radius:0px;
	  border-bottom:2px solid #eee;
	}
	.fadeInDown {
	  -webkit-animation-name: fadeInDown;
	  animation-name: fadeInDown;
	  -webkit-animation-duration: 1s;
	  animation-duration: 1s;
	  -webkit-animation-fill-mode: both;
	  animation-fill-mode: both;
	}
	@keyframes floating {
		0%, 100% { transform: translateY(0px); }
		50% { transform: translateY(-10px); }
	}
	.header-icon .icon-circle {
		animation: floating 3s ease-in-out infinite;
	}
	@-webkit-keyframes fadeInDown {
	  0% {
		opacity: 0;
		-webkit-transform: translate3d(0, -100%, 0);
		transform: translate3d(0, -100%, 0);
	  }
	  100% {
		opacity: 1;
		-webkit-transform: none;
		transform: none;
	  }
	}
	@keyframes fadeInDown {
	  0% {
		opacity: 0;
		-webkit-transform: translate3d(0, -100%, 0);
		transform: translate3d(0, -100%, 0);
	  }
	  100% {
		opacity: 1;
		-webkit-transform: none;
		transform: none;
	  }
	}
	@-webkit-keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
	@-moz-keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
	@keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
	.fadeIn {
	  opacity:0;
	  -webkit-animation:fadeIn ease-in 1;
	  -moz-animation:fadeIn ease-in 1;
	  animation:fadeIn ease-in 1;

	  -webkit-animation-fill-mode:forwards;
	  -moz-animation-fill-mode:forwards;
	  animation-fill-mode:forwards;

	  -webkit-animation-duration:1s;
	  -moz-animation-duration:1s;
	  animation-duration:1s;
	}
	.fadeIn.first {
	  -webkit-animation-delay: 0.4s;
	  -moz-animation-delay: 0.4s;
	  animation-delay: 0.4s;
	}
	.fadeIn.second {
	  -webkit-animation-delay: 0.6s;
	  -moz-animation-delay: 0.6s;
	  animation-delay: 0.6s;
	}
	.fadeIn.third {
	  -webkit-animation-delay: 0.8s;
	  -moz-animation-delay: 0.8s;
	  animation-delay: 0.8s;
	}
	.fadeIn.fourth {
	  -webkit-animation-delay: 1s;
	  -moz-animation-delay: 1s;
	  animation-delay: 1s;
	}
	.underlineHover:after {
	  display: block;
	  left: 0;
	  bottom: -10px;
	  width: 0;
	  height: 2px;
	  background-color: #56baed;
	  content: "";
	  transition: width 0.2s;
	}
	.underlineHover:hover {
	  color: #0d0d0d;
	}
	.underlineHover:hover:after{
	  width: 100%;
	}
	.error-input {
		border-color: #dc3545 !important;
		box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
		animation: shake 0.5s ease-in-out;
	}
	@keyframes shake {
		0%, 100% { transform: translateX(0); }
		25% { transform: translateX(-5px); }
		75% { transform: translateX(5px); }
	}
	.custom-notification {
		backdrop-filter: blur(10px);
	}
	.custom-notification:hover {
		transform: translateX(-5px) !important;
	}
	@media (max-width: 768px) {
		.custom-notification {
			right: 10px !important;
			left: 10px !important;
			max-width: none !important;
			top: 130px !important;
		}
	}
	
	/* CSS Khusus untuk Opsi Jawaban */
	.option-label {
		display: block;
		background: #f8f9fa;
		border: 2px solid #e8ecf1;
		border-radius: 12px;
		padding: 15px;
		margin-bottom: 10px;
		cursor: pointer;
		transition: all 0.2s ease;
	}
	.option-label:hover {
		background: #e9ecef;
		border-color: #4a7fb8;
	}
	.option-label.selected {
		background: #d4edda;
		border-color: #28a745;
		font-weight: 600;
	}
	.option-input {
		display: none;
	}
	.option-letter {
		display: inline-block;
		width: 25px;
		height: 25px;
		line-height: 21px;
		text-align: center;
		border: 2px solid #326698;
		border-radius: 50%;
		margin-right: 15px;
		font-weight: 600;
		color: #326698;
	}
	.option-label.selected .option-letter {
		background: #28a745;
		border-color: #28a745;
		color: white;
	}
</style>

<script>
	// ⬇️ GANTI DENGAN URL APPS SCRIPT BARU ANDA DARI LANGKAH 2 ⬇️
	var SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwXpq1gt4fMHMnNAXnRpUQd2N3f1ZBASQ78zC08GqYUVwgbw_U0Voo9SUwVZXa3DGl0EQ/exec";

	var userData, mapelData;
	var allQuestions = [];
	var currentQuestionIndex = 0;
	var userAnswers = [];

	$(document).ready(function() {
		// 1. Verifikasi Login dan Mapel
		userData = JSON.parse(sessionStorage.getItem('user_tryout'));
		mapelData = JSON.parse(sessionStorage.getItem('mapel_tryout'));

		if (!userData || !mapelData) {
			alert('Sesi Anda telah berakhir. Silakan login kembali.');
			window.location.href = 'index.html';
			return;
		}

		// 2. Tampilkan Info
		$('#user-info').text('Siswa: ' + userData.nama);
		$('#mapel-header').text('Mapel: ' + mapelData.nama);
		$('#loader').fadeIn();

		// 3. Ambil Soal dari Apps Script
		$.ajax({
			type: "GET",
			dataType: "json",
			data: { 
				action: "getSoal",
				mapel: mapelData.id
			},
			url: SCRIPT_URL,
			cache: false,
			success: function(result) {
				if (result && result.length > 0) {
					allQuestions = result;
					userAnswers = new Array(allQuestions.length).fill(null); // Siapkan array jawaban
					displayQuestion(currentQuestionIndex);
					$('#loader').fadeOut();
				} else {
					$('#quiz-container').html('<h3 class="text-danger">Gagal memuat soal.</h3><p>Tidak ada soal ditemukan untuk mata pelajaran ini.</p>');
					$('#loader').fadeOut();
				}
			},
			error: function() {
				$('#quiz-container').html('<h3 class="text-danger">Error Server.</h3><p>Gagal terhubung ke database soal. Silakan coba lagi nanti.</p>');
				$('#loader').fadeOut();
			}
		});

		// 4. Atur Tombol Navigasi
		$('#next-btn').on('click', function() {
			saveAnswer();
			if (currentQuestionIndex < allQuestions.length - 1) {
				currentQuestionIndex++;
				displayQuestion(currentQuestionIndex);
			}
		});

		$('#prev-btn').on('click', function() {
			saveAnswer();
			if (currentQuestionIndex > 0) {
				currentQuestionIndex--;
				displayQuestion(currentQuestionIndex);
			}
		});
		
		$('#submit-btn').on('click', function() {
			saveAnswer();
			if (confirm('Apakah Anda yakin ingin menyelesaikan ujian ini?')) {
				finishExam();
			}
		});
	});

	function displayQuestion(index) {
		var q = allQuestions[index];
		$('#question-text').html((index + 1) + ". " + q.pertanyaan);
		
		var optionsHtml = '';
		optionsHtml += createOption('A', q.opsi_a);
		optionsHtml += createOption('B', q.opsi_b);
		optionsHtml += createOption('C', q.opsi_c);
		optionsHtml += createOption('D', q.opsi_d);
		
		$('#options-container').html(optionsHtml);
		
		// Set jawaban sebelumnya jika ada
		if (userAnswers[index]) {
			$('#option-' + userAnswers[index]).prop('checked', true).parent().addClass('selected');
		}

		// Atur visibilitas tombol
		$('#prev-btn').prop('disabled', index === 0);
		$('#next-btn').toggle(index < allQuestions.length - 1);
		$('#submit-btn').toggle(index === allQuestions.length - 1);
		
		$('#question-counter').text('Soal ' + (index + 1) + ' / ' + allQuestions.length);
		
		// Atur event listener untuk pilihan
		$('.option-input').on('change', function() {
			$('.option-label').removeClass('selected');
			if ($(this).is(':checked')) {
				$(this).parent().addClass('selected');
			}
		});
	}
	
	function createOption(letter, text) {
		return `
			<label class="option-label">
				<input type="radio" class="option-input" name="option" id="option-${letter}" value="${letter}">
				<span class="option-letter">${letter}</span>
				${text}
			</label>
		`;
	}
	
	function saveAnswer() {
		var selectedOption = $('input[name="option"]:checked').val();
		if (selectedOption) {
			userAnswers[currentQuestionIndex] = selectedOption;
		}
	}
	
	function finishExam() {
		$('#loader').fadeIn();
		
		// Hitung skor
		var score = 0;
		for (var i = 0; i < allQuestions.length; i++) {
			if (userAnswers[i] === allQuestions[i].kunci) {
				score++;
			}
		}
		
		var totalQuestions = allQuestions.length;
		var finalScore = (score / totalQuestions) * 100;
		var correctAnswers = score;
		var wrongAnswers = totalQuestions - score;
		
		// Tampilkan hasil
		$('#formContent').html(`
			<div class="fadeIn text-center">
			  <div class="header-icon mb-4">
				<div class="icon-circle" style="background: #28a745;">
				  <i class="fas fa-check"></i>
				</div>
				<h4 class="mt-3 mb-1" style="color: #333; font-weight: 600;">Ujian Selesai</h4>
				<p class="text-muted" style="font-size: 14px;">Terima kasih, ${userData.nama}!</p>
			  </div>
			  
			  <h3 style="font-weight: 700; color: #326698;">Skor Akhir Anda: ${finalScore.toFixed(0)}</h3>
			  
			  <div class="mt-4" style="text-align: left; max-width: 300px; margin: 0 auto;">
				<p style="font-size: 1.1rem;"><strong>Total Soal:</strong> ${totalQuestions}</p>
				<p style="font-size: 1.1rem; color: #28a745;"><strong>Jawaban Benar:</strong> ${correctAnswers}</p>
				<p style="font-size: 1.1rem; color: #dc3545;"><strong>Jawaban Salah:</strong> ${wrongAnswers}</p>
			  </div>
			  
			  <div class="text-center mt-4">
				<button type="button" class="btn btn-primary btn-lg btn-block custom-btn" onClick="window.location.href='index.html'">
				  <i class="fas fa-home mr-2"></i>Kembali ke Halaman Utama
				</button>
			  </div>
			</div>
		`);
		
		$('#loader').fadeOut();
		sessionStorage.clear(); // Hapus semua sesi
	}

</script>
</body>
</html>
